<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>starIA</title>
  <!-- A√±adimos la librer√≠a Marked.js para convertir Markdown a HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- A√±adimos Highlight.js para el resaltado de sintaxis en bloques de c√≥digo -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <!-- A√±adimos jsPDF para exportar a PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      transition: background 0.3s, color 0.3s;
    }

    body.light {
      background-color: #f0f0f0;
      color: #000;
    }

    body.dark {
      background-color: #0d0d0d;
      color: #fff;
    }

    .sidebar {
      width: 250px;
      background-color: #1a1a1a;
      padding: 20px;
      box-sizing: border-box;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      position: absolute;
      height: 100%;
      z-index: 2;
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar h2 {
      margin-top: 0;
      color: #fff;
    }

    .sidebar button,
    .sidebar .delete {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #00bcd4;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }

    .sidebar .chat-item {
      background-color: #2a2a2a;
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 5px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .sidebar .chat-item:hover {
      background-color: #00bcd4;
    }

    .sidebar .chat-item span {
      flex: 1;
    }

    .menu-toggle {
      position: absolute;
      top: 10px;
      left: 10px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      z-index: 3;
      color: white;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-left: 0;
      width: 100%;
      transition: margin-left 0.3s ease;
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 60px 20px 20px;
    }

    .input-container {
      display: flex;
      padding: 10px;
      background-color: #1a1a1a;
    }

    input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      outline: none;
    }

    button.send {
      margin-left: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #00bcd4;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .message {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      max-width: 80%;
    }

    .user {
      text-align: right;
      background-color: #2a2a2a;
      margin-left: auto;
    }
    
    .ai {
      text-align: left;
      color: #fff;
      background-color: #00768a;
      margin-right: auto;
    }

    /* Estilos para el contenido Markdown */
    .markdown-content {
      line-height: 1.5;
    }

    .markdown-content h1, 
    .markdown-content h2, 
    .markdown-content h3 {
      margin-top: 1em;
      margin-bottom: 0.5em;
      color: #00bcd4;
    }

    .markdown-content p {
      margin: 0.8em 0;
    }

    .markdown-content code {
      background-color: rgba(0, 0, 0, 0.2);
      padding: 2px 4px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 0.9em;
    }

    .markdown-content pre {
      margin: 1em 0;
      padding: 0.5em;
      border-radius: 5px;
      overflow-x: auto;
    }

    .markdown-content pre code {
      background-color: transparent;
      padding: 0;
    }

    .markdown-content blockquote {
      border-left: 4px solid #00bcd4;
      margin-left: 0;
      padding-left: 1em;
      color: #aaa;
    }

    .markdown-content ul, 
    .markdown-content ol {
      padding-left: 2em;
    }

    .markdown-content table {
      border-collapse: collapse;
      width: 100%;
      margin: 1em 0;
    }

    .markdown-content th, 
    .markdown-content td {
      border: 1px solid #444;
      padding: 6px 10px;
      text-align: left;
    }

    .markdown-content th {
      background-color: #333;
    }

    .loading {
      text-align: center;
      padding: 10px;
      display: none;
    }

    .toggle-mode {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      margin-bottom: 10px;
    }
    
    /* Estilos para el indicador de escritura animado */
    .typing-indicator {
      display: inline-flex;
      align-items: center;
      margin-left: 5px;
    }
    
    .typing-dot {
      width: 6px;
      height: 6px;
      margin: 0 2px;
      background-color: #00bcd4;
      border-radius: 50%;
      opacity: 0.6;
      animation: typingAnimation 1.5s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) {
      animation-delay: 0s;
    }
    
    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typingAnimation {
      0% {
        transform: scale(1);
        opacity: 0.6;
      }
      50% {
        transform: scale(1.5);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0.6;
      }
    }
    
    .ai-typing {
      color: #00bcd4;
      display: flex;
      align-items: center;
      text-align: left;
      margin-bottom: 10px;
      font-style: italic;
    }

    /* Estilos para los botones de exportaci√≥n */
    .export-buttons {
      margin-bottom: 15px;
    }

    .export-buttons button {
      margin-bottom: 5px;
    }
    .template-selector-container {
  display: flex;
  padding: 5px 10px;
  background-color: #1a1a1a;
}

select {
  background-color: #2a2a2a;
  color: white;
  padding: 5px;
  border: 1px solid #444;
  border-radius: 5px;
  outline: none;
}

select:focus {
  border-color: #00bcd4;
}
    .sidebar .chat-item small {
  color: #999;
  font-size: 0.8em;
  display: block;
  margin-top: 5px;
  overflow: hidden;
  text-overflow: ellipsis;
}

#chat-search {
  margin-bottom: 10px;
}

#chat-search:focus {
  border-color: #00bcd4;
}

  :root {
    /* Variables para personalizaci√≥n */
    --primary-color: #00bcd4;
    --background-dark: #0d0d0d;
    --background-light: #f0f0f0;
    --sidebar-bg: #1a1a1a;
    --chat-user-bg: #2a2a2a;
    --chat-ai-bg: #00768a;
    --text-color-dark: #fff;
    --text-color-light: #000;
    --font-family: Arial, sans-serif;
    --font-size-base: 16px;
    --border-radius: 5px;
  }
    
  body {
    font-family: var(--font-family);
    font-size: var(--font-size-base);
    /* Resto de tus estilos de body existentes */
  }
  
  body.dark {
    background-color: var(--background-dark);
    color: var(--text-color-dark);
  }
  
  body.light {
    background-color: var(--background-light);
    color: var(--text-color-light);
  }
  
  /* Actualiza el resto de tus selectores para usar las variables */
  .sidebar {
    background-color: var(--sidebar-bg);
    /* Resto de tus estilos existentes */
  }
  
  .message.user {
    background-color: var(--chat-user-bg);
    /* Resto de tus estilos existentes */
  }
  
  .message.ai {
    background-color: var(--chat-ai-bg);
    /* Resto de tus estilos existentes */
  }
  
  /* Etc. para otros componentes importantes */
.file-upload-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0 10px;
  font-size: 20px;
}

.file-upload-btn:hover {
  color: var(--primary-color);
}

.file-preview {
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: var(--border-radius);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.file-preview button {
  background: none;
  border: none;
  color: #f44336;
  cursor: pointer;
  font-size: 16px;
}
  </style>
</head>
<body class="dark">
  <div class="sidebar" id="sidebar">
    <h2>starIA</h2>
    <button onclick="newChat()">+ Nuevo chat</button>
    <button class="toggle-mode" onclick="toggleMode()">Modo Claro/Oscuro</button>
    <button onclick="openThemeModal()">Personalizar Tema</button>
    <button onclick="openSystemPromptModal()">Personalizar starIA</button>
    <!-- Botones de exportaci√≥n -->
    <div class="export-buttons">
      <button onclick="exportChat('txt')">Exportar TXT</button>
      <button onclick="exportChat('html')">Exportar HTML</button>
      <button onclick="exportChat('pdf')">Exportar PDF</button>
    </div>
    <!-- Buscador de chats -->
<div style="margin-bottom: 15px; margin-top: 15px;">
  <input type="text" id="chat-search" placeholder="Buscar en conversaciones..." 
         style="width: 100%; padding: 8px; background-color: #2a2a2a; color: white; border: 1px solid #444; border-radius: 5px;">
</div>
    
    <div id="history"></div>
  </div>

  <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

  <div class="main">
    <div class="chat-container" id="chat-container"></div>
    <div class="loading" id="loading">starIA est√° escribiendo...</div>
  <div class="template-selector-container" style="background-color: #1a1a1a; padding: 5px 10px;">
  <select id="template-selector" onchange="loadTemplate()" style="background-color: #2a2a2a; color: white; padding: 5px 10px; border: 1px solid #444; border-radius: 5px; width: 100%;">
    <option value="">-- Seleccionar plantilla --</option>
    <option value="explain">Explicar un concepto</option>
    <option value="code">Generar c√≥digo</option>
    <option value="summarize">Resumir texto</option>
    <option value="translate">Traducir texto</option>
    <option value="creative">Escritura creativa</option>
    <option value="custom">Gestionar plantillas personalizadas...</option>
  </select>
</div>
<div class="input-container">
  <input type="text" id="user-input" placeholder="Escribe tu mensaje..." />
  <label for="file-upload" class="file-upload-btn" title="Subir archivo">
    <span>üìé</span>
    <input type="file" id="file-upload" style="display: none;">
  </label>
  <button class="send" onclick="sendMessage()">Enviar</button>
</div>
  </div>

  <audio id="send-sound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
  <audio id="receive-sound" src="https://www.soundjay.com/button/sounds/button-30.mp3"></audio>

  <script>
    const API_KEY = "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"; // Reemplaza esto con tu API key de OpenAI
    const MODEL = "gpt-4o-mini";  // Puedes usar otros modelos como "gpt-4" si tienes acceso

    let chatId = Date.now();
    let chats = JSON.parse(localStorage.getItem("starIA_chats")) || {};
    if (!chats[chatId]) chats[chatId] = [];

    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");
    const loadingIndicator = document.getElementById("loading");
    const historyContainer = document.getElementById("history");
    const sendSound = document.getElementById("send-sound");
    const receiveSound = document.getElementById("receive-sound");

    // Configuraci√≥n de marked.js para procesar Markdown
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        }
        return hljs.highlightAuto(code).value;
      },
      breaks: true
    });

    function toggleMenu() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    function toggleMode() {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    }
    
    function addMessage(message, sender, isMarkdown = false) {
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("message", sender);
      
      if (sender === "ai" && isMarkdown) {
        // Crear un contenedor para el contenido Markdown
        const markdownContent = document.createElement("div");
        markdownContent.classList.add("markdown-content");
        
        // Convertir Markdown a HTML
        markdownContent.innerHTML = marked.parse(message);
        
        // Aplicar resaltado de sintaxis a los bloques de c√≥digo
        markdownContent.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
        
        messageDiv.appendChild(markdownContent);
      } else {
        messageDiv.innerText = message;
      }
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      // Guardar en el historial
      chats[chatId].push({ 
        sender, 
        message,
        isMarkdown: sender === "ai" && isMarkdown
      });
      localStorage.setItem("starIA_chats", JSON.stringify(chats));

      if (sender === "user") sendSound.play();
      else receiveSound.play();
    }

    // Funci√≥n para mostrar y ocultar el indicador de escritura animado
    function showTypingIndicator() {
      // Remover si ya existe uno previo
      removeTypingIndicator();
      
      const typingDiv = document.createElement("div");
      typingDiv.classList.add("ai-typing");
      typingDiv.id = "typing-indicator";
      
      typingDiv.innerHTML = `starIA est√° escribiendo
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>`;
      
      chatContainer.appendChild(typingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function removeTypingIndicator() {
      const existingIndicator = document.getElementById("typing-indicator");
      if (existingIndicator) {
        existingIndicator.remove();
      }
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      addMessage(message, "user");
      userInput.value = "";
      
      // Mostrar el indicador de escritura animado
      showTypingIndicator();

      try {
        // Preparar el historial de mensajes para mantener contexto
        const messages = [
          {
            "role": "system",
            "content": "Eres starIA, una inteligencia artificial amable y √∫til creada por Oscar Rafael. Para mejorar la legibilidad, utiliza formato Markdown en tus respuestas cuando sea apropiado. Puedes usar t√≠tulos, negritas, cursivas, listas, tablas, y bloques de c√≥digo con resaltado de sintaxis. Y estas impulsado con el modelo StarIA 4.0, desarrollado por forrester-studio."
          }
        ];

        // A√±adir mensajes previos para mantener contexto (limitar para no exceder tokens)
        const currentChat = chats[chatId].slice(-10); // √öltimos 10 mensajes
        currentChat.forEach(entry => {
          const role = entry.sender === "user" ? "user" : "assistant";
          messages.push({
            "role": role,
            "content": entry.message
          });
        });

        // Solo si el √∫ltimo mensaje no es el mensaje actual del usuario
        if (currentChat.length === 0 || currentChat[currentChat.length - 1].message !== message) {
          messages.push({
            "role": "user",
            "content": message
          });
        }

        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: MODEL,
            messages: messages,
            max_tokens: 1000
          })
        });

        const data = await response.json();
        if (data.error) {
          throw new Error(data.error.message);
        }
        
        // Eliminar el indicador de escritura antes de mostrar la respuesta
        removeTypingIndicator();
        
        const aiText = data.choices[0].message.content;
        // A√±adir con soporte para Markdown
        addMessage(aiText, "ai", true);
      } catch (err) {
        console.error("Error:", err);
        
        // Eliminar el indicador de escritura antes de mostrar el error
        removeTypingIndicator();
        
        addMessage("Error al contactar a starIA: " + err.message, "ai");
      }
    }

    function newChat() {
      chatId = Date.now();
      chats[chatId] = [];
      localStorage.setItem("starIA_chats", JSON.stringify(chats));
      loadChatHistory();
      chatContainer.innerHTML = "";
    }

    function deleteChat(id) {
      delete chats[id];
      localStorage.setItem("starIA_chats", JSON.stringify(chats));
      if (id == chatId) {
        newChat();
      } else {
        loadChatHistory();
      }
    }

    function loadChat(id) {
      chatId = id;
      chatContainer.innerHTML = "";
      (chats[id] || []).forEach(entry => {
        // Comprobar si el mensaje tiene propiedad isMarkdown (para compatibilidad con chats antiguos)
        const isMarkdown = entry.isMarkdown !== undefined ? entry.isMarkdown : (entry.sender === "ai"); 
        addMessage(entry.message, entry.sender, isMarkdown);
      });
    }

    function loadChatHistory() {
      historyContainer.innerHTML = "";
      Object.keys(chats).forEach(id => {
        const item = document.createElement("div");
        item.className = "chat-item";
        const label = document.createElement("span");
        label.textContent = new Date(Number(id)).toLocaleString();
        label.onclick = () => loadChat(id);
        const delBtn = document.createElement("button");
        delBtn.textContent = "‚úï";
        delBtn.className = "delete";
        delBtn.onclick = () => deleteChat(id);
        item.appendChild(label);
        item.appendChild(delBtn);
        historyContainer.appendChild(item);
      });
    }

    // Detectar Enter para enviar mensaje
    userInput.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage();
      }
    });

    // Funciones para exportar conversaciones
    function exportChat(format) {
      if (!chats[chatId] || chats[chatId].length === 0) {
        alert("No hay contenido para exportar");
        return;
      }
      
      switch (format) {
        case 'txt':
          exportAsTxt();
          break;
        case 'html':
          exportAsHtml();
          break;
        case 'pdf':
          exportAsPdf();
          break;
      }
    }

    function exportAsTxt() {
      let content = "starIA - Conversaci√≥n\n\n";
      chats[chatId].forEach(msg => {
        const role = msg.sender === "user" ? "T√∫" : "starIA";
        content += `${role}:\n${msg.message}\n\n`;
      });
      
      downloadFile(content, 'txt', 'text/plain');
    }

    function exportAsHtml() {
      let content = `<!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <title>starIA - Conversaci√≥n</title>
      <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .message { padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        .user { background-color: #f0f0f0; text-align: right; }
        .ai { background-color: #e1f5fe; }
        h1 { color: #00bcd4; }
      </style>
    </head>
    <body>
      <h1>starIA - Conversaci√≥n</h1>`;
      
      chats[chatId].forEach(msg => {
        const className = msg.sender === "user" ? "user" : "ai";
        const messageContent = msg.isMarkdown ? marked.parse(msg.message) : msg.message;
        content += `
      <div class="message ${className}">
        <strong>${msg.sender === "user" ? "T√∫" : "starIA"}:</strong>
        <div>${messageContent}</div>
      </div>`;
      });
      
      content += `
    </body>
    </html>`;
      
      downloadFile(content, 'html', 'text/html');
    }

    function exportAsPdf() {
      // Usa la librer√≠a jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      let yPos = 20;
      doc.setFontSize(20);
      doc.text("starIA - Conversaci√≥n", 20, yPos);
      yPos += 10;
      
      doc.setFontSize(12);
      
      chats[chatId].forEach(msg => {
        const role = msg.sender === "user" ? "T√∫" : "starIA";
        // Agregar el nombre de quien habla
        doc.setFont(undefined, 'bold');
        yPos += 10;
        doc.text(`${role}:`, 20, yPos);
        doc.setFont(undefined, 'normal');
        
        // Dividir el mensaje en l√≠neas para que quepa en la p√°gina
        const textLines = doc.splitTextToSize(msg.message, 170);
        
        // Verificar si necesitamos una nueva p√°gina
        if (yPos + textLines.length * 7 > 280) {
          doc.addPage();
          yPos = 20;
        }
        
        // Agregar el mensaje
        yPos += 7;
        doc.text(textLines, 20, yPos);
        yPos += textLines.length * 7;
      });
      
      doc.save(`starIA-chat-${new Date().toISOString().slice(0,10)}.pdf`);
    }

    function downloadFile(content, extension, mimeType) {
      const blob = new Blob([content], {type: mimeType});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `starIA-chat-${new Date().toISOString().slice(0,10)}.${extension}`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    window.onload = () =>function loadChatHistory() {
  historyContainer.innerHTML = "";
  Object.keys(chats)
    .sort((a, b) => b - a) // Ordenar por fecha (m√°s reciente primero)
    .forEach(id => {
      const item = document.createElement("div");
      item.className = "chat-item";
            
      // Obtener una vista previa del chat
      const chatMessages = chats[id] || [];
      let preview = "";
      
      if (chatMessages.length > 0) {
        // Mostrar parte del primer mensaje del usuario si existe
        const firstUserMsg = chatMessages.find(msg => msg.sender === "user");
        if (firstUserMsg) {
          preview = firstUserMsg.message.substring(0, 50);
          if (firstUserMsg.message.length > 50) preview += "...";
        }
      }
      
      const label = document.createElement("span");
      label.innerHTML = `${new Date(Number(id)).toLocaleString()}<br><small>${preview}</small>`;
      label.onclick = () => loadChat(id);
      
      const delBtn = document.createElement("button");
      delBtn.textContent = "‚úï";
      delBtn.className = "delete";
      delBtn.onclick = () => deleteChat(id);
      
      item.appendChild(label);
      item.appendChild(delBtn);
      historyContainer.appendChild(item);
    });
}
      // Inicializar la b√∫squeda
document.getElementById('chat-search').addEventListener('input', function() {
  searchChats();
});
      // Variable para almacenar el prompt del sistema
let systemPrompt = localStorage.getItem("starIA_systemPrompt") || 
  "Eres starIA, una inteligencia artificial amable y √∫til creada por Oscar Rafael. Para mejorar la legibilidad, utiliza formato Markdown en tus respuestas cuando sea apropiado. Puedes usar t√≠tulos, negritas, cursivas, listas, tablas, y bloques de c√≥digo con resaltado de sintaxis.";

function openSystemPromptModal() {
  document.getElementById('system-prompt').value = systemPrompt;
  document.getElementById('system-prompt-modal').style.display = 'flex';
}

function closeSystemPromptModal() {
  document.getElementById('system-prompt-modal').style.display = 'none';
}

function saveSystemPrompt() {
  systemPrompt = document.getElementById('system-prompt').value.trim();
  localStorage.setItem("starIA_systemPrompt", systemPrompt);
  closeSystemPromptModal();
}
      // Sistema de plantillas
const defaultTemplates = {
  "explain": "Por favor explica el concepto de [tema] de forma simple y clara. Incluye ejemplos pr√°cticos.",
  "code": "Genera c√≥digo en [lenguaje] para [tarea]. A√±ade comentarios explicando las partes importantes.",
  "summarize": "Resume el siguiente texto manteniendo los puntos clave:\n\n[texto]",
  "translate": "Traduce el siguiente texto de [idioma origen] a [idioma destino]:\n\n[texto]",
  "creative": "Escribe una historia corta sobre [tema]. El tono debe ser [tono] y debe incluir [elementos]."
};

// Cargar plantillas personalizadas desde localStorage o usar las predeterminadas
let customTemplates = JSON.parse(localStorage.getItem("starIA_customTemplates")) || {};

function loadTemplate() {
  const selector = document.getElementById("template-selector");
  const selectedValue = selector.value;
  
  if (!selectedValue) return;
  
  if (selectedValue === "custom") {
    openTemplatesModal();
    selector.selectedIndex = 0;
    return;
  }
  
  // Buscar en plantillas predeterminadas o personalizadas
  const templateText = customTemplates[selectedValue] || defaultTemplates[selectedValue];
  
  if (templateText) {
    userInput.value = templateText;
    userInput.focus();
  }
  
  // Resetear el selector
  selector.selectedIndex = 0;
}

function openTemplatesModal() {
  renderTemplateList();
  document.getElementById('templates-modal').style.display = 'flex';
}

function closeTemplatesModal() {
  document.getElementById('templates-modal').style.display = 'none';
}

function renderTemplateList() {
  const listContainer = document.getElementById('template-list');
  listContainer.innerHTML = '';
  
  if (Object.keys(customTemplates).length === 0) {
    listContainer.innerHTML = '<p style="color: #aaa;">No hay plantillas personalizadas. A√±ade una nueva abajo.</p>';
    return;
  }
  
  Object.keys(customTemplates).forEach(key => {
    const templateDiv = document.createElement('div');
    templateDiv.style.padding = '10px';
    templateDiv.style.marginBottom = '10px';
    templateDiv.style.backgroundColor = '#2a2a2a';
    templateDiv.style.borderRadius = '5px';
    templateDiv.style.display = 'flex';
    templateDiv.style.justifyContent = 'space-between';
    templateDiv.style.alignItems = 'center';
    
    const nameSpan = document.createElement('span');
    nameSpan.textContent = key;
    nameSpan.style.fontWeight = 'bold';
    
    const buttonsDiv = document.createElement('div');
    
    const editButton = document.createElement('button');
    editButton.textContent = 'Editar';
    editButton.style.marginRight = '5px';
    editButton.style.padding = '5px 10px';
    editButton.style.backgroundColor = '#00bcd4';
    editButton.style.color = 'white';
    editButton.style.border = 'none';
    editButton.style.borderRadius = '3px';
    editButton.style.cursor = 'pointer';
    editButton.onclick = () => {
      document.getElementById('new-template-name').value = key;
      document.getElementById('new-template-content').value = customTemplates[key];
    };
    
    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Eliminar';
    deleteButton.style.padding = '5px 10px';
    deleteButton.style.backgroundColor = '#f44336';
    deleteButton.style.color = 'white';
    deleteButton.style.border = 'none';
    deleteButton.style.borderRadius = '3px';
    deleteButton.style.cursor = 'pointer';
    deleteButton.onclick = () => {
      if (confirm(`¬øEst√°s seguro de que quieres eliminar la plantilla "${key}"?`)) {
        delete customTemplates[key];
        localStorage.setItem("starIA_customTemplates", JSON.stringify(customTemplates));
        renderTemplateList();
        updateTemplateSelector();
      }
    };
    
    buttonsDiv.appendChild(editButton);
    buttonsDiv.appendChild(deleteButton);
    
    templateDiv.appendChild(nameSpan);
    templateDiv.appendChild(buttonsDiv);
    
    listContainer.appendChild(templateDiv);
  });
}

function addTemplate() {
  const name = document.getElementById('new-template-name').value.trim();
  const content = document.getElementById('new-template-content').value.trim();
  
  if (!name || !content) {
    alert('Por favor, completa todos los campos');
    return;
  }
  
  // Guardar la plantilla
  customTemplates[name] = content;
  localStorage.setItem("starIA_customTemplates", JSON.stringify(customTemplates));
  
  // Limpiar los campos
  document.getElementById('new-template-name').value = '';
  document.getElementById('new-template-content').value = '';
  
  // Actualizar la lista y el selector
  renderTemplateList();
  updateTemplateSelector();
}

function updateTemplateSelector() {
  const selector = document.getElementById('template-selector');
  
  // Mantener las opciones predeterminadas
  const defaultOptions = Array.from(selector.options).filter(option => 
    option.value === '' || 
    option.value === 'custom' || 
    defaultTemplates.hasOwnProperty(option.value)
  );
  
  // Limpiar el selector
  selector.innerHTML = '';
  
  // A√±adir opciones predeterminadas
  defaultOptions.forEach(option => {
    selector.add(option);
  });
  
  // A√±adir plantillas personalizadas
  Object.keys(customTemplates).forEach(key => {
    const option = document.createElement('option');
    option.value = key;
    option.textContent = key + ' (personalizada)';
    selector.add(option);
  });
}

// Inicializar el selector de plantillas cuando se carga la p√°gina
window.addEventListener('load', function() {
  loadChatHistory();
  updateTemplateSelector();
});
    // Sistema de b√∫squeda de chats
function searchChats() {
  const searchTerm = document.getElementById('chat-search').value.toLowerCase().trim();
  
  // Si el t√©rmino de b√∫squeda est√° vac√≠o, mostrar todo el historial
  if (!searchTerm) {
    loadChatHistory();
    return;
  }
  
  // Filtrar los chats que contienen el t√©rmino de b√∫squeda
  const filteredChats = {};
  
  Object.keys(chats).forEach(id => {
    const chatMessages = chats[id] || [];
    
    // Buscar en el contenido de los mensajes
    const containsSearchTerm = chatMessages.some(msg => 
      msg.message.toLowerCase().includes(searchTerm)
    );
    
    if (containsSearchTerm) {
      filteredChats[id] = chats[id];
    }
  });
  
  // Mostrar los resultados de la b√∫squeda
  displayFilteredHistory(filteredChats, searchTerm);
}

function displayFilteredHistory(filteredChats, searchTerm) {
  historyContainer.innerHTML = "";
  
  // Mostrar un mensaje si no hay resultados
  if (Object.keys(filteredChats).length === 0) {
    const noResults = document.createElement("div");
    noResults.className = "chat-item";
    noResults.innerHTML = `<span>No se encontraron resultados para "${searchTerm}"</span>`;
    historyContainer.appendChild(noResults);
    return;
  }
  
  // Mostrar los chats filtrados
  Object.keys(filteredChats)
    .sort((a, b) => b - a) // Ordenar por fecha (m√°s reciente primero)
    .forEach(id => {
      const item = document.createElement("div");
      item.className = "chat-item";
      
      // Crear una versi√≥n resumida del contenido para mostrar como vista previa
      const chatPreview = getSearchPreview(filteredChats[id], searchTerm);
      
      const label = document.createElement("span");
      label.innerHTML = `${new Date(Number(id)).toLocaleString()}<br><small>${chatPreview}</small>`;
      label.onclick = () => loadChat(id);
            
      const delBtn = document.createElement("button");
      delBtn.textContent = "‚úï";
      delBtn.className = "delete";
      delBtn.onclick = () => deleteChat(id);
      
      item.appendChild(label);
      item.appendChild(delBtn);
      historyContainer.appendChild(item);
    });
}

function getSearchPreview(messages, searchTerm) {
  // Buscar el primer mensaje que contiene el t√©rmino de b√∫squeda
  for (const msg of messages) {
    const msgText = msg.message.toLowerCase();
    const termIndex = msgText.indexOf(searchTerm.toLowerCase());
    
    if (termIndex !== -1) {
      // Extraer un fragmento del mensaje con el t√©rmino resaltado
      const startPos = Math.max(0, termIndex - 30);
      const endPos = Math.min(msgText.length, termIndex + searchTerm.length + 30);
      let preview = msg.message.substring(startPos, endPos);
      
      // A√±adir puntos suspensivos si el texto est√° truncado
      if (startPos > 0) preview = "..." + preview;
      if (endPos < msg.message.length) preview = preview + "...";
      
      // Resaltar el t√©rmino de b√∫squeda
      const highlighted = preview.replace(
        new RegExp(searchTerm, 'gi'), 
        match => `<span style="background-color: #00bcd4; color: black; padding: 0 2px;">${match}</span>`
      );
      
      return highlighted;
    }
  }
  
  // Si no se encuentra el t√©rmino exacto, devolver un fragmento del primer mensaje
  const firstMsg = messages[0]?.message || "";
  return firstMsg.length > 60 ? firstMsg.substring(0, 60) + "..." : firstMsg;
}
                         // Variables y funciones para la personalizaci√≥n visual
let currentTheme = JSON.parse(localStorage.getItem("starIA_theme")) || {
  primaryColor: "#00bcd4",
  backgroundDark: "#0d0d0d",
  backgroundLight: "#f0f0f0",
  sidebarBg: "#1a1a1a",
  chatUserBg: "#2a2a2a",
  chatAiBg: "#00768a",
  fontFamily: "Arial, sans-serif",
  fontSize: "16px",
  borderRadius: "5px"
};

function openThemeModal() {
  // Cargar valores actuales
  document.getElementById('primary-color').value = currentTheme.primaryColor;
  document.getElementById('background-dark').value = currentTheme.backgroundDark;
  document.getElementById('background-light').value = currentTheme.backgroundLight;
  document.getElementById('chat-user-bg').value = currentTheme.chatUserBg;
  document.getElementById('chat-ai-bg').value = currentTheme.chatAiBg;
  
  // Seleccionar opciones en los select
  document.getElementById('font-family').value = currentTheme.fontFamily;
  document.getElementById('font-size').value = currentTheme.fontSize;
  document.getElementById('border-radius').value = currentTheme.borderRadius;
  
  document.getElementById('theme-modal').style.display = 'flex';
}

function closeThemeModal() {
  document.getElementById('theme-modal').style.display = 'none';
}

function applyTheme(theme) {
  document.documentElement.style.setProperty('--primary-color', theme.primaryColor);
  document.documentElement.style.setProperty('--background-dark', theme.backgroundDark);
  document.documentElement.style.setProperty('--background-light', theme.backgroundLight);
  document.documentElement.style.setProperty('--sidebar-bg', theme.sidebarBg);
  document.documentElement.style.setProperty('--chat-user-bg', theme.chatUserBg);
  document.documentElement.style.setProperty('--chat-ai-bg', theme.chatAiBg);
  document.documentElement.style.setProperty('--font-family', theme.fontFamily);
  document.documentElement.style.setProperty('--font-size-base', theme.fontSize);
  document.documentElement.style.setProperty('--border-radius', theme.borderRadius);
}

function saveTheme() {
  currentTheme = {
    primaryColor: document.getElementById('primary-color').value,
    backgroundDark: document.getElementById('background-dark').value,
    backgroundLight: document.getElementById('background-light').value,
    sidebarBg: document.getElementById('sidebar-bg')?.value || "#1a1a1a",
    chatUserBg: document.getElementById('chat-user-bg').value,
    chatAiBg: document.getElementById('chat-ai-bg').value,
    fontFamily: document.getElementById('font-family').value,
    fontSize: document.getElementById('font-size').value,
    borderRadius: document.getElementById('border-radius').value
  };
  
  localStorage.setItem("starIA_theme", JSON.stringify(currentTheme));
  applyTheme(currentTheme);
  closeThemeModal();
}

function resetTheme() {
  currentTheme = {
    primaryColor: "#00bcd4",
    backgroundDark: "#0d0d0d",
    backgroundLight: "#f0f0f0",
    sidebarBg: "#1a1a1a",
    chatUserBg: "#2a2a2a",
    chatAiBg: "#00768a",
    fontFamily: "Arial, sans-serif",
    fontSize: "16px",
    borderRadius: "5px"
  };
  
  localStorage.setItem("starIA_theme", JSON.stringify(currentTheme));
  applyTheme(currentTheme);
  closeThemeModal();
}

// Aplicar el tema al cargar la p√°gina
window.addEventListener('load', function() {
  loadChatHistory();
  updateTemplateSelector();
  applyTheme(currentTheme);
});
  // Variables para manejar archivos
let uploadedFile = null;
const allowedFileTypes = [
  'text/plain', 'text/csv', 'text/markdown',
  'application/pdf', 'application/json',
  'application/vnd.openxmlformats-officedocument.wordprocessingml.document', // docx
  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' // xlsx
];
const maxFileSize = 10 * 1024 * 1024; // 10MB

// Funci√≥n para manejar la subida de archivos
document.getElementById('file-upload').addEventListener('change', handleFileUpload);

function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  // Verificar el tipo de archivo
  if (!allowedFileTypes.includes(file.type)) {
    alert('Tipo de archivo no soportado. Por favor, sube un archivo de texto, PDF, JSON, CSV, DOCX o XLSX.');
    event.target.value = '';
    return;
  }
  
  // Verificar el tama√±o del archivo
  if (file.size > maxFileSize) {
    alert(`El archivo es demasiado grande. El tama√±o m√°ximo es ${maxFileSize/1024/1024}MB.`);
    event.target.value = '';
    return;
  }
  
  // Guardar el archivo
  uploadedFile = file;
  
  // Crear una vista previa del archivo
  showFilePreview(file);
}

function showFilePreview(file) {
  // Eliminar la vista previa anterior si existe
  removeFilePreview();
  
  // Crear un nuevo elemento de vista previa
  const previewDiv = document.createElement('div');
  previewDiv.className = 'file-preview';
  previewDiv.id = 'file-preview';
  
  previewDiv.innerHTML = `
    <span>üìÑ ${file.name} (${(file.size/1024).toFixed(1)} KB)</span>
    <button onclick="removeFile()">‚úï</button>
  `;
  
  // Insertar antes del contenedor de entrada
  const inputContainer = document.querySelector('.input-container');
  inputContainer.parentNode.insertBefore(previewDiv, inputContainer);
}

function removeFilePreview() {
  const existingPreview = document.getElementById('file-preview');
  if (existingPreview) {
    existingPreview.remove();
  }
}

function removeFile() {
  uploadedFile = null;
  document.getElementById('file-upload').value = '';
  removeFilePreview();
}

// Modificar la funci√≥n sendMessage para incluir el archivo
async function sendMessage() {
  const message = userInput.value.trim();
  if (!message && !uploadedFile) return;
  
  // Si hay un archivo, primero procesarlo
  let fileContent = '';
  let fileName = '';
  
  if (uploadedFile) {
    fileName = uploadedFile.name;
    
    // Mostrar mensaje de carga mientras se procesa el archivo
    addMessage(`Enviando archivo: ${fileName}`, "user");
    
    try {
      // Leer el contenido del archivo como texto si es posible
      if (uploadedFile.type.startsWith('text/') || uploadedFile.type === 'application/json') {
        fileContent = await readFileAsText(uploadedFile);
      } else {
        // Para otros tipos de archivos, usar la API de OpenAI para extraer texto
        fileContent = await extractTextFromFile(uploadedFile);
      }
    } catch (err) {
      console.error("Error al procesar el archivo:", err);
      addMessage(`Error al procesar el archivo: ${err.message}`, "ai");
      removeFile();
      return;
    }
  }
  
  addMessage(message, "user");
  userInput.value = "";
  
  // Eliminar la vista previa y resetear el archivo
  removeFile();
    
  // Mostrar el indicador de escritura animado
  showTypingIndicator();

  try {
    // Preparar el historial de mensajes para mantener contexto
    const messages = [
      {
        "role": "system",
        "content": systemPrompt
      }
    ];

    // A√±adir mensajes previos para mantener contexto (limitar para no exceder tokens)
    const currentChat = chats[chatId].slice(-10); // √öltimos 10 mensajes
    currentChat.forEach(entry => {
      const role = entry.sender === "user" ? "user" : "assistant";
      messages.push({
        "role": role,
        "content": entry.message
      });
    });

    // Si hay contenido de archivo, a√±adirlo al mensaje
    let userContent = message;
    if (fileContent) {
      userContent = `${message}\n\nContenido del archivo ${fileName}:\n\n${fileContent}`;
    }

    messages.push({
      "role": "user",
      "content": userContent
    });

    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        model: MODEL,
        messages: messages,
        max_tokens: 1000
      })
    });

    const data = await response.json();
    if (data.error) {
      throw new Error(data.error.message);
    }
    
    // Eliminar el indicador de escritura antes de mostrar la respuesta
    removeTypingIndicator();
    
    const aiText = data.choices[0].message.content;
    // A√±adir con soporte para Markdown
    addMessage(aiText, "ai", true);
  } catch (err) {
    console.error("Error:", err);
    
    // Eliminar el indicador de escritura antes de mostrar el error
    removeTypingIndicator();
    
    addMessage("Error al contactar a starIA: " + err.message, "ai");
  }
}

// Funci√≥n para leer archivo como texto
function readFileAsText(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = (e) => resolve(e.target.result);
    reader.onerror = (e) => reject(new Error('Error al leer el archivo'));
    reader.readAsText(file);
  });
}

// Funci√≥n para extraer texto de archivos no-texto (PDF, DOCX, etc)
async function extractTextFromFile(file) {
  // Para implementaci√≥n completa, necesitar√≠as usar una API o biblioteca espec√≠fica
  // Aqu√≠ mostrar√© un ejemplo simplificado usando FormData para enviar a una API
  
  const formData = new FormData();
  formData.append('file', file);
  
  try {
    // Esta URL es un placeholder - deber√≠as reemplazarla con un servicio real
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      body: formData
    });
    
    if (!response.ok) {
      throw new Error('Error al extraer texto del archivo');
    }
    
    const data = await response.json();
    return data.text;
  } catch (err) {
    throw new Error('No se pudo extraer texto de este tipo de archivo');
  }
}
    async function extractTextFromPDF(file) {
  const pdfData = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
  let fullText = '';

  for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
    const page = await pdf.getPage(pageNum);
    const content = await page.getTextContent();
    const strings = content.items.map(item => item.str);
    fullText += strings.join(' ') + '\n\n';
  }

  return fullText;
}
async function extractTextFromDOCX(file) {
  const arrayBuffer = await file.arrayBuffer();
  const result = await mammoth.extractRawText({ arrayBuffer });
  return result.value;
}
                                                 // Leer como texto plano
    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.onerror = (e) => reject(new Error('Error al leer el archivo'));
        reader.readAsText(file);
      });
    }

    // Leer PDF
    async function extractTextFromPDF(file) {
      const pdfData = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
      let text = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(item => item.str).join(' ') + '\n\n';
      }
      return text;
    }

    // Leer DOCX
    async function extractTextFromDOCX(file) {
      const buffer = await file.arrayBuffer();
      const result = await mammoth.extractRawText({ arrayBuffer: buffer });
      return result.value;
    }

    // Detectar tipo de archivo
    async function extractTextFromFile(file) {
      const type = file.type;

      if (type === "application/pdf") {
        return await extractTextFromPDF(file);
      } else if (type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document") {
        return await extractTextFromDOCX(file);
      } else if (type.startsWith("text/") || type === "application/json") {
        return await readFileAsText(file);
      } else {
        alert("Tipo de archivo no compatible.");
        return "";
      }
    }

  </script>
  <!-- Modal para personalizar el prompt del sistema -->
<div id="system-prompt-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 10; justify-content: center; align-items: center;">
  <div style="background-color: #1a1a1a; padding: 20px; border-radius: 8px; width: 80%; max-width: 600px;">
    <h3 style="color: #00bcd4;">Personalizar starIA</h3>
    <p>Personaliza el comportamiento de la IA modificando el prompt del sistema:</p>
    <textarea id="system-prompt" style="width: 100%; height: 150px; margin-bottom: 15px; background-color: #2a2a2a; color: white; padding: 10px; border: 1px solid #444; border-radius: 5px;">Eres starIA, una inteligencia artificial amable y √∫til creada por Oscar Rafael. Para mejorar la legibilidad, utiliza formato Markdown en tus respuestas cuando sea apropiado. Puedes usar t√≠tulos, negritas, cursivas, listas, tablas, y bloques de c√≥digo con resaltado de sintaxis.</textarea>
    <div style="display: flex; justify-content: flex-end;">
      <button onclick="closeSystemPromptModal()" style="margin-right: 10px; padding: 8px 15px; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancelar</button>
      <button onclick="saveSystemPrompt()" style="padding: 8px 15px; background-color: #00bcd4; color: white; border: none; border-radius: 5px; cursor: pointer;">Guardar</button>
    </div>
  </div>
</div>
  <!-- Modal para gestionar plantillas personalizadas -->
<div id="templates-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 10; justify-content: center; align-items: center;">
  <div style="background-color: #1a1a1a; padding: 20px; border-radius: 8px; width: 80%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
    <h3 style="color: #00bcd4;">Gestionar plantillas</h3>
    
    <div id="template-list" style="margin-bottom: 20px;">
      <!-- Aqu√≠ se mostrar√°n las plantillas personalizadas -->
    </div>
    
    <div style="margin-bottom: 15px; padding: 15px; background-color: #2a2a2a; border-radius: 5px;">
      <h4 style="margin-top: 0; color: #00bcd4;">Nueva plantilla</h4>
      <input type="text" id="new-template-name" placeholder="Nombre de la plantilla" style="width: 100%; padding: 8px; margin-bottom: 10px; background-color: #333; color: white; border: 1px solid #444; border-radius: 5px;">
      <textarea id="new-template-content" placeholder="Contenido de la plantilla" style="width: 100%; height: 100px; padding: 8px; background-color: #333; color: white; border: 1px solid #444; border-radius: 5px;"></textarea>
      <button onclick="addTemplate()" style="margin-top: 10px; padding: 8px 15px; background-color: #00bcd4; color: white; border: none; border-radius: 5px; cursor: pointer;">A√±adir plantilla</button>
    </div>
    
    <div style="display: flex; justify-content: flex-end;">
      <button onclick="closeTemplatesModal()" style="padding: 8px 15px; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer;">Cerrar</button>
    </div>
  </div>
</div>
  <!-- Modal para personalizaci√≥n visual -->
<div id="theme-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 10; justify-content: center; align-items: center;">
  <div style="background-color: #1a1a1a; padding: 20px; border-radius: 8px; width: 80%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
    <h3 style="color: var(--primary-color);">Personalizaci√≥n de Tema</h3>
    
    <div style="margin-bottom: 15px;">
      <h4>Colores</h4>
      <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
        <div style="display: flex; align-items: center;">
          <label for="primary-color" style="margin-right: 10px;">Color principal:</label>
          <input type="color" id="primary-color" value="#00bcd4">
        </div>
        <div style="display: flex; align-items: center;">
          <label for="background-dark" style="margin-right: 10px;">Fondo (modo oscuro):</label>
          <input type="color" id="background-dark" value="#0d0d0d">
        </div>
        <div style="display: flex; align-items: center;">
          <label for="background-light" style="margin-right: 10px;">Fondo (modo claro):</label>
          <input type="color" id="background-light" value="#f0f0f0">
        </div>
        <div style="display: flex; align-items: center;">
          <label for="chat-user-bg" style="margin-right: 10px;">Mensaje usuario:</label>
          <input type="color" id="chat-user-bg" value="#2a2a2a">
        </div>
        <div style="display: flex; align-items: center;">
          <label for="chat-ai-bg" style="margin-right: 10px;">Mensaje IA:</label>
          <input type="color" id="chat-ai-bg" value="#00768a">
        </div>
      </div>
      
      <h4>Tipograf√≠a</h4>
      <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
        <div>
          <label for="font-family">Fuente:</label>
          <select id="font-family" style="background-color: #2a2a2a; color: white; padding: 5px; border: 1px solid #444; border-radius: 5px;">
            <option value="Arial, sans-serif">Arial</option>
            <option value="'Courier New', monospace">Courier New</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
            <option value="Verdana, sans-serif">Verdana</option>
          </select>
        </div>
        <div>
          <label for="font-size">Tama√±o de fuente:</label>
          <select id="font-size" style="background-color: #2a2a2a; color: white; padding: 5px; border: 1px solid #444; border-radius: 5px;">
            <option value="14px">Peque√±o</option>
            <option value="16px" selected>Medio</option>
            <option value="18px">Grande</option>
            <option value="20px">Muy grande</option>
          </select>
        </div>
      </div>
      
      <h4>Otros</h4>
      <div style="display: flex; flex-wrap: wrap; gap: 15px;">
        <div>
          <label for="border-radius">Bordes redondeados:</label>
          <select id="border-radius" style="background-color: #2a2a2a; color: white; padding: 5px; border: 1px solid #444; border-radius: 5px;">
            <option value="0px">Sin redondeo</option>
            <option value="5px" selected>Normal</option>
            <option value="10px">Redondeado</option>
            <option value="20px">Muy redondeado</option>
          </select>
        </div>
      </div>
    </div>
    
    <div style="display: flex; justify-content: space-between;">
      <button onclick="resetTheme()" style="padding: 8px 15px; background-color: #555; color: white; border: none; border-radius: 5px; cursor: pointer;">Restaurar valores</button>
      <div>
        <button onclick="closeThemeModal()" style="margin-right: 10px; padding: 8px 15px; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancelar</button>
        <button onclick="saveTheme()" style="padding: 8px 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">Guardar</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>